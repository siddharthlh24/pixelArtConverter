<!DOCTYPE html>
<html>
<head>
  <title>Pixel Filter WebApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 10px; padding: 0; }
    img { display: block; margin-top: 10px; }
    .preview { max-width: 100%; max-height: 60vh; object-fit: contain; border: 1px solid #ccc; margin-bottom: 10px; }
    input, select { width: 100%; max-width: 300px; margin-bottom: 10px; }
    label { display: block; margin-bottom: 5px; }
    form { max-width: 400px; }
    h1, h2 { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Pixel Filter</h1>
  <form method="post" enctype="multipart/form-data">
    <p>
      <label>Upload Image:</label>
      <input type="file" name="image">
    </p>

    {% if stored_image %}
      <input type="hidden" name="stored_image" value="{{ stored_image }}">
      <p>Current Image:</p>
      <img class="preview" src="/uploads/{{ stored_image }}" alt="Current Image">
    {% endif %}


    <h3>Select LUT</h3>
    <div id="lut_gallery" style="display:flex; flex-wrap:wrap; gap:10px;">
      {% for lut in lut_files %}
        <label class="lut-card" style="cursor:pointer; border:1px solid #ccc; padding:5px; display:flex; flex-direction:column; align-items:center; width:auto; max-width:150px;">
          <!-- Hidden radio button -->
          <input type="radio" name="lut_select" value="{{ lut.name }}"
                style="display:none;"
                {% if request.form.get('lut_select') == lut.name %}checked{% endif %}>
          
          <!-- Color row -->
          <div class="color-row" style="display:flex; flex-wrap:wrap; gap:1px; justify-content:center; margin-bottom:5px; max-width:140px;">
            {% for color in lut.colors %}
              <div style="width:15px; height:15px; background:{{ color }}; border:1px solid #ccc;"></div>
            {% endfor %}
          </div>

          <!-- LUT filename -->
          <span style="font-size:12px; text-align:center; word-break:break-word;">{{ lut.name }}</span>
        </label>
      {% endfor %}
    </div>

<style>
  /* Highlight selected LUT */
  .lut-card input[type="radio"]:checked + .color-row {
      outline: 2px solid #007bff;
      outline-offset: 2px;
  }
  .lut-card:hover {
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
</style>
    <p>
      <label>Or upload your own LUT:</label>
      <input type="file" name="palette">
    </p>

    <p>
      <label>Pixel Scale (1â€“100%): <span id="scale_value">{{ request.form.pixel_scale if request.form.get('pixel_scale') else '100' }}</span>%</label>
      <input type="range" min="1" max="100" step="1" name="pixel_scale"
            value="{{ request.form.pixel_scale if request.form.get('pixel_scale') else '100' }}"
            id="pixel_scale_slider" oninput="document.getElementById('scale_value').innerText = this.value">
    </p>

    <p><label><input type="checkbox" name="dither" {% if request.form.get('dither') %}checked{% endif %}> Use Dithering</label></p>
    <p><label><input type="checkbox" name="outlines" {% if request.form.get('outlines') %}checked{% endif %}> Hard Outlines</label></p>

    <p><input type="submit" value="Apply Filter"></p>
  </form>

  {% if preview_img_url %}
    <h2>Filtered Result:</h2>
    <img class="preview" src="{{ preview_img_url }}" alt="Filtered Image">
    <p><a download="{{ download_name }}" href="{{ result_img_url }}">Download Full Image</a></p>
  {% endif %}

</body>
</html>
