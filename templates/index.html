<!DOCTYPE html>
<html>
<head>
  <title>Pixel Filter WebApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 10px; padding: 0; }
    img { display: block; margin-top: 10px; }
    .preview { max-width: 100%; max-height: 60vh; object-fit: contain; border: 1px solid #ccc; margin-bottom: 10px; }
    input, select { width: 100%; max-width: 300px; margin-bottom: 10px; }
    label { display: block; margin-bottom: 5px; }
    form { max-width: 400px; }
    h1, h2 { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Pixel Filter</h1>
  <form method="post" enctype="multipart/form-data">
    <p>
      <label>Upload Image:</label>
      <input type="file" name="image">
    </p>

    {% if stored_image %}
      <input type="hidden" name="stored_image" value="{{ stored_image }}">
      <p>Current Image:</p>
      <img class="preview" src="/uploads/{{ stored_image }}" alt="Current Image">
    {% endif %}


    <p>
      <label>Select LUT from folder:</label>
      <select name="lut_select">
        <option value="">-- none --</option>
        {% for lut in lut_files %}
          <option value="{{ lut }}" {% if request.form.get('lut_select') == lut %}selected{% endif %}>{{ lut }}</option>
        {% endfor %}
      </select>
    </p>

    <p>
      <label>Or upload your own LUT:</label>
      <input type="file" name="palette">
    </p>

    <p>
      <label>Pixel Scale (1â€“100%): <span id="scale_value">{{ request.form.pixel_scale if request.form.get('pixel_scale') else '100' }}</span>%</label>
      <input type="range" min="1" max="100" step="1" name="pixel_scale"
            value="{{ request.form.pixel_scale if request.form.get('pixel_scale') else '100' }}"
            id="pixel_scale_slider" oninput="document.getElementById('scale_value').innerText = this.value">
    </p>

    <p><label><input type="checkbox" name="dither" {% if request.form.get('dither') %}checked{% endif %}> Use Dithering</label></p>
    <p><label><input type="checkbox" name="outlines" {% if request.form.get('outlines') %}checked{% endif %}> Hard Outlines</label></p>

    <p><input type="submit" value="Apply Filter"></p>
  </form>

  {% if result_img_b64 %}
    <h2>Filtered Result:</h2>
    <img class="preview" src="data:image/png;base64,{{ result_img_b64 }}" alt="Filtered Image">
    <p><a download="{{ download_name }}" href="data:image/png;base64,{{ result_img_b64 }}">Download Image</a></p>
  {% endif %}
</body>
</html>
