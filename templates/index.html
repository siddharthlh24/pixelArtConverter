<!DOCTYPE html>
<html>
<head>
  <title>Pixel Filter WebApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 10px; padding: 0; }
    img { display: block; margin-top: 10px; }
    .preview { max-width: 100%; max-height: 60vh; object-fit: contain; border: 1px solid #ccc; margin-bottom: 10px; }
    input, select { width: 100%; max-width: 300px; margin-bottom: 10px; }
    label { display: block; margin-bottom: 5px; }
    form { max-width: 400px; }
    h1, h2 { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Pixel Filter</h1>
  <form method="post" enctype="multipart/form-data">
    <p>
      <label>Upload Image:</label>
      <input type="file" name="image">
    </p>

    {% if original_img_b64 %}
      <input type="hidden" name="original_img" value="{{ original_img_b64 }}">
      <input type="hidden" name="original_filename" value="{{ request.form.original_filename if request.form.get('original_filename') else 'filtered.png' }}">
      <p>Current Image:</p>
      <img class="preview" src="data:image/png;base64,{{ original_img_b64 }}" alt="Original Image">
    {% endif %}

    <p>
      <label>Select LUT from folder:</label>
      <select name="lut_select">
        <option value="">-- none --</option>
        {% for lut in lut_files %}
          <option value="{{ lut }}" {% if request.form.get('lut_select') == lut %}selected{% endif %}>{{ lut }}</option>
        {% endfor %}
      </select>
    </p>

    <p>
      <label>Or upload your own LUT:</label>
      <input type="file" name="palette">
    </p>

    <p>
      <label>Pixel Scale (0.1â€“1.0):</label>
      <input type="number" step="0.1" name="pixel_scale" value="{{ request.form.pixel_scale if request.form.get('pixel_scale') else '1.0' }}">
    </p>

    <p><label><input type="checkbox" name="dither" {% if request.form.get('dither') %}checked{% endif %}> Use Dithering</label></p>
    <p><label><input type="checkbox" name="outlines" {% if request.form.get('outlines') %}checked{% endif %}> Hard Outlines</label></p>

    <p><input type="submit" value="Apply Filter"></p>
  </form>

  {% if result_img_b64 %}
    <h2>Filtered Result:</h2>
    <img class="preview" src="data:image/png;base64,{{ result_img_b64 }}" alt="Filtered Image">
    <p><a download="{{ download_name }}" href="data:image/png;base64,{{ result_img_b64 }}">Download Image</a></p>
  {% endif %}
</body>
</html>
